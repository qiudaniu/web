<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>17商城</title>
<link type="text/css" href="css/css.css" rel="stylesheet" />
<script type="text/javascript" src="js/jquery.js"></script>
<script src="js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>
 <div class="mianCont">
  <div class="top">
   <div id="notLogin">
    <span>您好！欢迎来到17商城 请&nbsp;<a href="login.html">[登录]</a>&nbsp;<a href="reg.html">[注册]</a></span>
   </div>
   <div id="login" style="display: none">
    <span><a href="" onclick="logout()">[退出]</a></span>
    <span class="topRight">
    <a href="vip.html">我的17</a>&nbsp;|
    <a href="orders.html">我的订单</a>&nbsp;|
    <a href="vip.html">会员中心</a>&nbsp;|
    <a href="contact.html">联系我们</a>
   </span>
   </div>
  </div><!--top/-->
  <div class="lsg">
   <h1 class="logo"><a href="index.html"><img src="images/logo.png" width="217" height="90" /></a></h1>
   <div class="subBox">
    <div class="subBoxDiv">
     <input type="text" class="subLeft" id="searchName"/>
     <div onclick="search($('#searchName').val())"><input type="image" src="images/subimg.png" width="63" height="34" class="sub"/></div>
    </div><!--subBoxDiv/-->
   </div><!--subBox/-->
   <div class="gouwuche">
    <div class="gouCar" style="display: none;">
     <img src="images/gouimg.png" width="19" height="20" style="position:relative;top:6px;" />&nbsp;|&nbsp;
     <strong class="red" id="num">0</strong>&nbsp;件&nbsp;|
     <strong class="red" id="price">￥ 0.00</strong>
     <a href="order.html">去结算</a> <img src="images/youjian.jpg" width="5" height="8" />
    </div><!--gouCar/-->
    <div class="myChunlv">
     <a href="vip.html"><img src="images/mychunlv.jpg" width="112" height="34" /></a>
    </div><!--myChunlv/-->
   </div><!--gouwuche/-->
  </div><!--lsg/-->
  <div class="pnt">
   <div class="pntLeft">
    <h2 class="Title">所有商品分类
     <ul class="InPorNav">

     </ul>
    </h2>
   </div><!--pntLeft/-->
   <div class="pntRight">
    <ul class="nav">
     <li><a href="index.html">商城首页</a></li>
     <li><a href="vip.html">会员中心</a></li>
     <li class="navCur"><a href="help.html">帮助中心</a></li>
     <div class="clears"></div>
     <div class="phone">TEL：021-12345678</div>
    </ul><!--nav/-->
   </div><!--pntRight/-->
   <div class="clears"></div>
  </div><!--pnt/-->
  <div class="positions">
   当前位置：<a href="index.html">首页</a> &gt; <a href="#" class="posCur">购物车</a>
  </div><!--positions/-->
  <div class="cont">
   <div class="carImg"><img src="images/car1.jpg" width="951" height="27" /></div>
   <table class="orderList">

    </tr>
   </table><!--orderList/-->
   <div class="zongji">
    总计(不含运费)：<strong class="red">￥<span id="p"></span></strong>
   </div><!--zongji/-->
   <div class="jiesuan">
    <a href="product.html" class="jie_1">继续购物&gt;&gt;</a>
    <a onclick="jie_2()" class="jie_2">立即结算&gt;&gt;</a>
    <div class="clears"></div>
   </div><!--jiesuan/-->
   <div class="clears"></div>
  </div><!--cont/-->
  <div class="inHelp">
   <div class="inHLeft">
    <h4>帮助中心</h4>
    <ul class="inHeList">
     <li><a href="help.html">购物指南</a></li>
     <li><a href="help.html">支付方式</a></li>
     <li><a href="help.html">售后服务</a></li>
     <li><a href="about.html">企业简介</a></li>
     <div class="clears"></div>
    </ul><!--inHeList/-->
   </div><!--inHLeft/-->
   <div class="inHLeft">
    <h4>会员服务</h4>
    <ul class="inHeList">
     <li><a href="reg.html">会员注册</a></li>
     <li><a href="login.html">会员登录</a></li>
     <li><a href="order.html">购物车</a></li>
     <li><a href="order.html">我的订单</a></li>
     <div class="clears"></div>
    </ul><!--inHeList/-->
   </div><!--inHLeft/-->
   <div class="inHRight">
    <h4>全国统一免费服务热线</h4>
    <div class="telBox">400-0000-0000</div>
    <div class="weibo">
    <wb:follow-button uid="2991975565" type="red_1" width="67" height="24" ></wb:follow-button>
    </div>
   </div><!--inHRight/-->
   <div class="clears"></div>
  </div><!--inHelp/-->
  <div class="footer">
   <p>
   <a href="#">进入17官网</a>&nbsp;|&nbsp;
   <a href="index.html">商城首页</a>&nbsp;|&nbsp;
   <a href="product.html">促销中心</a>&nbsp;|&nbsp;
   <a href="order.html">我的订单</a>&nbsp;|&nbsp;
   <a href="new.html">新闻动态</a>&nbsp;|&nbsp;
   <a href="login.html">会员中心</a>&nbsp;|&nbsp;
   <a href="help.htmll">帮助中心</a>
   </p>
   <p>
    版权所有：上海17实业有限公司 版权所有  Copyright 2010-2015   沪ICP备00000000号   <a href="http://www.mycodes.net/" target="_blank">源码之家</a>   
   </p>
  </div><!--footer/-->
 </div><!--mianCont/-->
 <a href="#" class="backTop">&nbsp;</a>
 <script type="text/javascript" src="js/jquery.js"></script>
 <script type="text/javascript" src="js/js.js"></script>
 <script src="js/wb.js" type="text/javascript" charset="utf-8"></script>
 <script type="text/javascript">
     $.ajax({
         url: "http://qiudaniu.top:5002/bazinga/api/shopCart/getUserShopCarts",
         type: 'get',
         data: {
             userId: localStorage.getItem('user_id')
         },
         headers: {
             'user_token': localStorage.getItem('token')
         },
         success: function (res) {
             if (res.code == 200){
                 var str = '<tr><th width="20"></th><th width="430">商品</th><th width="135">单价</th><th width="135">数量</th><th width="135">总金额</th><th>操作</th></tr>';
                 var data = res.data;
                 for (var i=0; i<data.length; i++){
                     str += '<tr id="'+data[i].id+'"><td style="display: none" id="goodId_'+data[i].id+'">'+data[i].good.id+'</td><td><input onclick="changeAllPrice()" type="checkbox" name="car_id" checked value="'+data[i].id+'" /></td><td><dl><dt><a href="proinfo.html?id='+data[i].good.id+'"><img src="'+data[i].good.pic+'" width="85" height="85" /></a></dt>'+
                         '<dd>'+data[i].good.name+'</dd><div class="clears"></div></dl></td><td><strong class="red">￥<span id="price_'+data[i].id+'">'+data[i].good.presentPrice+'</span></strong></td> <td><div class="jia_jian"><input type="text" class="shuliang" id="shuliang_'+data[i].id+'" onchange="allPrice(this.value, '+data[i].id+')" value="'+data[i].amount+'" /></div></td>'+
                         '<td><strong class="red">￥<span id="allPrice_'+data[i].id+'">'+data[i].amount*data[i].good.presentPrice+'</span></strong></td><td><a href="#" onclick="deleteGoods('+data[i].id+')" class="green">删除</a></td></tr><tr>';
                 }
                 $(".orderList").html(str);
             }
             var p = 0;
          $('input[name="car_id"]:checked').each(function(){//遍历每一个名字为interest的复选框，其中选中的执行函数
           p += parseInt($("#allPrice_" + $(this).val()).text())
          });
          $("#p").text(p);
         }
     });
     function deleteGoods(id) {
         $.ajax({
             url: "http://qiudaniu.top:5002/bazinga/api/shopCart/deleteShopCart",
             type: 'post',
             headers: {
                 'user_token' : localStorage.getItem('token')
             },
             data: {
                 shopCartId: id
             },
             success: function(res){
                 if (res.code == 200){
                     alert(res.msg);
                     window.location.href = 'order.html';
                 }
             }
         })
     }
     
     function allPrice(value, id) {
         var price = $("#price_" + id).text();
         var allPrice = value* price;
         $("#allPrice_"+id).text(allPrice);
         changeAllPrice();
     }

     function changeAllPrice() {
      var p = 0;
      $('input[name="car_id"]:checked').each(function(){//遍历每一个名字为interest的复选框，其中选中的执行函数
       p += parseInt($("#allPrice_" + $(this).val()).text())
      });
      $("#p").text(p);
     }

     function jie_2() {
      $('input[name="car_id"]:checked').each(function(){//遍历每一个名字为interest的复选框，其中选中的执行函数
       var amount = $("#shuliang_" + $(this).val()).val();
       var good_id = $("#goodId_" + $(this).val()).text();
       $.ajax({
        url: "http://qiudaniu.top:5002/bazinga/api/order/createOrder",
        type: "post",
        data: JSON.stringify({
          'shopCartId' : $(this).val(),
          'amount' : amount,
          'goodId' : good_id,
          'userId' : localStorage.getItem('user_id')
        }),
        contentType: 'application/json',
        headers: {
         'user_token' : localStorage.getItem('token')
        },
        success: function (res) {
          if (res.code == 200){
           window.location.href = "success.html";
          }
        }
       })
      });

     }
 </script>
</body>
</html>
